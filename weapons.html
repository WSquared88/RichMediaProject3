<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="HaloHighlightsStyles.css" media="screen"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	<title>Weapons</title>
	
	<script type="text/javascript">
	var PROXY_URL = "proxy.php?filename=";
	var API_KEY = "470d55269e6389f7c2f4be6604d8a0c54ed12fc0";
	
	var getTwitch = function()
	{
		console.log("getting Twitchy");
		var game = $('#gameQuery').val();
		$(function()
		{
			$.ajax({
				url: "https://api.twitch.tv/kraken/search/streams?q="+game,
				type: "GET",
				// Request body
				data: null,
				dataType: "json",
			})
			.done(function(e) 
			{
				console.log("works");
				console.dir(e);
				jsonLoaded(e);
			})
			.fail(function(e) 
			{
				console.log("broke");
				console.dir(e);
				jsonLoaded(e);
				//alert("error");
			});
		});
	}
	
	var getData = function()
	{
		var game = $('#gameQuery').val();
		document.querySelector("#search-container").innerHTML = "<b>Searching for " + game + "</b>";
		getTwitch();
		$(function() 
		{
		  //console.log("http://www.giantbomb.com/api/game/3030-4725/?api_key="+API_KEY+"&format=json");
			$.ajax({
				url: "http://www.giantbomb.com/api/search/?api_key="+API_KEY+'&format=jsonp&query="'+game+'"&resources=game&json_callback=jsonLoaded',
				type: "GET",
				// Request body
				data: null,
				dataType: "jsonp",
			})
			.done(function(e) 
			{
				console.log("works");
				console.dir(e);
				//jsonLoaded(e);
			})
			.fail(function(e) 
			{
				console.log("broke");
				console.dir(e);
				//jsonLoaded(e);
				//alert("error");
			});
		});
	}
	
	var jsonLoaded = function(e)
	{
		console.log("JSON is loaded");
		console.dir(e);
		if(e.error != "OK")
		{
			console.log("The API threw an error!");
			return;
		}
		console.log("The API actually worked");
		var games = e.results;
		console.log(games);
		var html = "";
		for(var i = 0;i<games.length;i++)
		{
			html += "<div class='content'>";
			if(games[i].image)
			{
				html += "<img src='"+games[i].image.medium_url+"'></img>";
			}
			
			if(games[i].name)
			{
				html += "<h2>"+games[i].name+"</h2>";
			}
			else
			{
				html += "<h2>The title could not be found</h2>";
			}
			
			if(games[i].description)
			{
				html += "<p>"+games[i].description+"</p>";
			}
			else
			{
				html += "<p>There is no description for this game</p>";
			}
			
			html += "</div>";
		}
		document.querySelector('#search-container').innerHTML = html;
		
		$("#search-container").fadeIn(500);
	}
</script>
	
</head>
<body>
	<h1>Weapons</h1>
	<div class="content">
		<img class="contentImage" src="media/Project 3 content menu.png" width="270" height="230"></img>
		<div class="contentFiller">
			<h2>Designated Marksman Rifle "DMR"</h2>
			<p>The DMR is super cool</p>
		</div>
	</div>
	
	<div id="buttons">
      <label> <input id="gameQuery" value='fallout' type="text"/><button id="search-button" onclick="getData()">Search</button></label>
    </div>
    <div id="search-container">
    </div>
</body>
</html>